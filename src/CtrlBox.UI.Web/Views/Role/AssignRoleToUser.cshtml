@model CtrlBox.UI.Web.Models.Role.RoleViewModel

@{
    ViewData["Title"] = "AssignRoleToUser";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section cssViews{
    <!-- BEGIN PAGE LEVEL STYLES -->
    <link rel="stylesheet" type="text/css" href="~/plugins/select2/select2_metro.css" />
    <!-- END PAGE LEVEL STYLES -->
}
@section scriptsViews{
    <!-- BEGIN PAGE LEVEL PLUGINS -->
    <script type="text/javascript" src="~/plugins/select2/select2.min.js"></script>

    <!-- END PAGE LEVEL PLUGINS -->
}

<script type="text/javascript">
    jQuery(document).ready(function () {

        //<!-- BEGIN AspNetUserRoles -->
        $("#btnRole").click(function () {
            var selections = (JSON.stringify($("#ddlRoles").select2('data')));

            $.ajax({
                url: '@Url.Content("~/Role/PostAjaxHandlerRoles")',
                type: 'POST',
                dataType: 'json',
                data: { rolesJSON: selections, userID: $("#ddlUsersRole").val() },
                "success": function (json) {
                    if (!json.NotAuthorized) {
                        alert('Complete');
                    }
                }              
            });
            event.preventDefault();
        });

        $('#ddlRoles').select2({
            placeholder: "Select a Roles",
            allowClear: true
        });

        $("#ddlUsersRole").change(function (event) {
            $('#ddlRoles').val(null).trigger('change');
            $('#ddlRoles').empty().trigger("change");

            if ($(this).val() !== '0') {
                var url = '@Url.Content("~/Role/GetAjaxHandlerRoles")'
                $.getJSON(url, { userID: $(this).val() }, function (data) {
                    $.each(data, function (index, obj) {
                        var newOption = new Option(obj.Text, obj.Value, false, obj.Selected);
                        $('#ddlRoles').append(newOption).trigger('change');
                    });
                });
            }
        });
        //<!-- END AspNetUserRoles -->

        //<!-- BEGIN AspNetRoleClaims -->
        var ddlRolesClaim = "#ddlClaims";
        $("#btnRoleClaim").click(function () {
            var selections = (JSON.stringify($(ddlRolesClaim).select2('data')));

            $.ajax({
                url: '@Url.Content("~/Role/PostAjaxHandlerClaimsToRole")',
                type: 'POST',
                dataType: 'json',
                data: { claimsJSON: selections, roleID: $("#ddlRolesClaim").val() },
                "success": function (json) {
                    if (!json.NotAuthorized) {
                        alert('Complete');
                    }
                }
            });
            event.preventDefault();
        });

        $(ddlRolesClaim).select2({
            placeholder: "Select a Claims",
            allowClear: true
        });

        $("#ddlRolesClaim").change(function (event) {
            $(ddlRolesClaim).val(null).trigger('change');
            $(ddlRolesClaim).empty().trigger("change");

            if ($(this).val() !== '0') {
                var url = '@Url.Content("~/Role/GetAjaxHandlerClaimsRoles")'
                $.getJSON(url, { roleID: $(this).val() }, function (data) {
                    $.each(data, function (index, obj) {
                        var newOption = new Option(obj.Text, obj.Value, false, obj.Selected);
                        $(ddlRolesClaim).append(newOption).trigger('change');
                    });
                });
            }
        });
        //<!-- END AspNetRoleClaims -->

        //<!-- BEGIN AspNetUserClaims -->
        var ddlRolesClaim = "#ddlClaimsUsers";
        $("#btnUserClaim").click(function () {
            var selections = (JSON.stringify($(ddlRolesClaim).select2('data')));

            $.ajax({
                url: '@Url.Content("~/Role/PostAjaxHandlerClaimsToUser")',
                type: 'POST',
                dataType: 'json',
                data: { claimsJSON: selections, userID: $("#ddlUsersClaim").val() },
                "success": function (json) {
                    if (!json.NotAuthorized) {
                        alert('Complete');
                    }
                }
            });
            event.preventDefault();
        });


        $(ddlRolesClaim).select2({
            placeholder: "Select a Claims",
            allowClear: true
        });

        $("#ddlUsersClaim").change(function (event) {
            $(ddlRolesClaim).val(null).trigger('change');
            $(ddlRolesClaim).empty().trigger("change");

            if ($(this).val() !== '0') {
                var url = '@Url.Content("~/Role/GetAjaxHandlerClaimsUsers")'
                var ddlSource = "#ddlUsersClaim";
                $.getJSON(url, { userID: $(ddlSource).val() }, function (data) {
                    $.each(data, function (index, obj) {
                        var newOption = new Option(obj.Text, obj.Value, false, obj.Selected);
                        $(ddlRolesClaim).append(newOption).trigger('change');
                    });
                });
            }
        });
        
    });
</script>

<!-- BEGIN PAGE -->
<div class="page-content">
    <!-- BEGIN PAGE CONTAINER-->
    <div class="container-fluid">
        <!-- BEGIN PAGE HEADER-->
        <div class="row-fluid">
            <div class="span12">
                <!-- BEGIN PAGE TITLE & BREADCRUMB-->
                <ul class="breadcrumb">
                    <li>
                        <i class="icon-home"></i>
                        <a href="index.html">Security</a>
                        <i class="icon-angle-right"></i>
                    </li>
                    <li>
                        <a href="#">Identity</a>
                        <i class="icon-angle-right"></i>
                    </li>
                    <li><a href="#">Policy</a></li>
                </ul>
                <!-- END PAGE TITLE & BREADCRUMB-->
            </div>
        </div>
        <!-- END PAGE HEADER-->
        <!-- BEGIN PAGE CONTENT-->
        <div class="row-fluid">
            <div class="span12">
                <div class="portlet box blue">
                    <div class="portlet-title">
                        <div class="caption"><i class="icon-key"></i>Policy permission AspNetUserRoles</div>
                    </div>
                    <div class="portlet-body form">
                        <h3 class="block">Add roles to user</h3>
                        <!-- BEGIN FORM-->
                        <form action="#" class="form-horizontal">
                            <div class="control-group">
                                <label class="control-label">List users</label>
                                <div class="controls">
                                    <select id="ddlUsersRole" class="span6" data-placeholder="Choose a user" tabindex="1" name="UserSelected" asp-for="UserSelected" asp-items="@Model.AllUsers"> <option value="0">Please select user</option></select>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">Select some</label>
                                <div class="controls">
                                    <select id="ddlRoles" data-placeholder="Policy role" class="span6 select2" tabindex="0" multiple="multiple" name="RoleSelected"> <option value="0">Please select roles</option></select>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button id="btnRole" type="button" class="btn blue">Save</button>
                                <button type="button" class="btn">Cancel</button>
                            </div>
                        </form>
                        <!-- END FORM-->
                    </div>
                </div>
            </div>
        </div>
        <div class="row-fluid">
            <div class="span12">
                <div class="portlet box blue">
                    <div class="portlet-title">
                        <div class="caption"><i class="icon-key"></i>Policy permission AspNetRoleClaims</div>
                    </div>
                    <div class="portlet-body form">
                        <h3 class="block">Add claims to role</h3>
                        <!-- BEGIN FORM-->
                        <form action="#" class="form-horizontal">
                            <div class="control-group">
                                <label class="control-label">List roles</label>
                                <div class="controls">
                                    <select id="ddlRolesClaim" class="span6" data-placeholder="Choose a role" tabindex="1" name="RoleSelected" asp-for="RoleSelected" asp-items="@Model.AllRoles"> <option value="0">Please select role</option></select>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">Select some</label>
                                <div class="controls">
                                    <select id="ddlClaims" data-placeholder="Policy claim" class="span6 select2" tabindex="0" multiple="multiple" name="ClaimSelected"> <option value="0">Please select claims</option></select>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button id="btnRoleClaim" type="button" class="btn blue">Save</button>
                                <button type="button" class="btn">Cancel</button>
                            </div>
                        </form>
                        <!-- END FORM-->
                    </div>
                </div>
            </div>
        </div>
        <div class="row-fluid">
            <div class="span12">
                <div class="portlet box blue">
                    <div class="portlet-title">
                        <div class="caption"><i class="icon-key"></i>Policy permission AspNetUserClaims</div>
                    </div>
                    <div class="portlet-body form">
                        <h3 class="block">Add claims to user</h3>
                        <!-- BEGIN FORM-->
                        <form action="#" class="form-horizontal">
                            <div class="control-group">
                                <label class="control-label">List users</label>
                                <div class="controls">
                                    <select id="ddlUsersClaim" class="span6" data-placeholder="Choose a user" tabindex="1" name="UserSelected" asp-for="UserSelected" asp-items="@Model.AllUsers"> <option value="0">Please select user</option></select>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">Select some</label>
                                <div class="controls">
                                    <select id="ddlClaimsUsers" data-placeholder="Policy claim" class="span6 select2" tabindex="0" multiple="multiple" name="ClaimSelected"> <option value="0">Please select claims</option></select>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button id="btnUserClaim" type="button" class="btn blue">Save</button>
                                <button type="button" class="btn">Cancel</button>
                            </div>
                        </form>
                        <!-- END FORM-->
                    </div>
                </div>
            </div>
        </div>

        <!-- END PAGE CONTENT-->
    </div>
    <!-- END PAGE CONTAINER-->
</div>
<!-- END PAGE -->
